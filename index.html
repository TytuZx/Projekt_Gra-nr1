<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Game Project1</title>
    <script src="http://127.0.0.1/Game-Project1/phaser-3.55.2/dist/phaser.js"></script>
    <!-- <script src="phaser.min.js"></script> -->
    <script src="scripts/menu.js"></script>
    <script src="scripts/game.js"></script>

    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">


  var player; // ta zmienna to bedzie nasz gracz
  var cursors; // zmienna pomocnicza służąca do odczytu klawiszy 
  var playerSpeed = 5; // dodanie prędkości postaci
  var platform, lamp, background, light, door;



var Preloader = new Phaser.Class({     

    Extends: Phaser.Scene,

    initialize:

    function MainMenu () 
    {
        Phaser.Scene.call(this, { key: 'preloader' });
    },

    preload: function()
    {
        this.load.image('buttonStart', 'assets/PlayButton2.png');
        this.scene.start('mainmenu');
    }


})


var MainMenu = new Phaser.Class({  // komponent menu

    Extends: Phaser.Scene,

    initialize:

    function MainMenu () 
    {
        Phaser.Scene.call(this, { key: 'mainmenu' });
        window.MENU = this;
    },

    preload: function()
    {
        this.load.image('buttonStart', 'assets/PlayButton2.png');
        this.load.image('buttonQuit', 'assets/QuitButton2.png');

    },

    
    create:  function () 
    {
        var bs = this.add.image(800, 450, 'buttonStart');
        var bq = this.add.image(800, 550, 'buttonQuit');


        bs.setInteractive();

        bs.once('pointerup', function () {

            this.scene.start('intro');

        }, this);
    }

})

var Intro = new Phaser.Class({


    Extends: Phaser.Scene,

    initialize:

    function Intro () 
    {
        Phaser.Scene.call(this, { key: 'intro' });
        window.GAME = this;
    },

    preload: function() //ładowanie plików do gry (tekstury etc.)
    {
        this.load.image('groundp', 'assets/ground.png'); //ładowanie konkretnego pliku
        this.load.image('groundj', 'assets/ground.jpg');
    },


    
    create: function () 
    {

       this.add.text(500, 300, 'Stage1 \n\n\n obudziłeś sie w ciemnej jaskini, nie wiesz co się stało\n i jak się z niej wydostać\n\n\n naciśnij spację aby przejść dalej....', // wątek fabularny
       { fill: '#fff'
       });

       this.input.keyboard.on('keydown-SPACE', this.startStage1, this); // ustawienie nasłuchiwania na naciśnięcie spacji
    },

    startStage1: function () {   // funkcja która ładuję się po naciśnięciu spacji
        this.scene.start('stage1');
    },

}) 


var Stage1 = new Phaser.Class({  // poziom pierwszy gry

    Extends: Phaser.Scene,

    initialize:

    function MainMenu () 
    {
        Phaser.Scene.call(this, { key: 'stage1' });
        window.GAME = this;
    },

    preload: function() //ładowanie plików do gry (tekstury etc.)
    {
        cursors = this.input.keyboard.createCursorKeys(); // dodanie funkcji sterowania postacią
        platform = this.physics.add.staticGroup();


        this.load.image('groundp', 'assets/ground.png'); //ładowanie konkretnego pliku
        this.load.image('groundj', 'assets/ground.jpg');
        this.load.image('floor', 'assets/tile63.png'); 
        this.load.image('rightWall', 'assets/tile84.png');
        this.load.image('leftWall', 'assets/tile122.png');
        this.load.image('topWall', 'assets/tile46.png');
        this.load.image('door', 'assets/door1.png');
        this.load.image('lamp', ['assets/torch.png', 'assets/Solid_white.svg.png']);

    },
    
    create: function() //Funkcje ładowania rzeczy na ekran
    {
        var i;
        background = this.add.image(100, 100, 'groundj');
        iwall = 26; //zmienne do ustawiania długości generowanych ścian i sufitów jako równe
        itop = 46;

        this.lights.enable().setAmbientColor(0x111111);  // włączanie światła
        light = this.lights.addLight(380, 300, 300).setColor(0xffffff).setIntensity(1.4);

        platform = this.physics.add.staticGroup();
       
        newDistance = 0;    // tworzenie lewej ściany
        for(i = 0; i<iwall; i++) {
            platform.create(20, 0 + newDistance, 'leftWall');
            newDistance += 35;
        }
        newDistance = 0;

        for(i = 0; i<iwall; i++) {  // tworzenie prawej ściany
            platform.create(1580, 0 + newDistance, 'rightWall');
            newDistance += 35;
        }

        newDistance = 0;  // tworzenie sufitu
        for(i = 0; i<itop; i++) {
            platform.create(0 + newDistance, -2, 'topWall');
            newDistance += 35;
        }
        var newDistance = 0;
        // platform.create(300, 100, 'groundp').setScale(2).refreshBody();
        for(i = 0; i<itop; i++) {  // tworzenie podłogi
            platform.create(0 + newDistance, 906, 'floor');
            newDistance += 35;
        }
        newDistance = 0;

        lamp = this.add.sprite(400, 300, 'lamp');
        lightLamp = this.lights.addLight(380, 300, 300).setColor(0xffffff).setIntensity(0.5); // ustawienie światła dla lampy

        // lamp.setPipeline('Light2D');
        door = platform.create(80, 436, 'door');
        door.setPipeline('Light2D');  // funkcja która sprawia, że drzwi działają ze światłem
        

        player = this.physics.add.image(800, 450, 'groundp').setScale(0.3); // wczytanie bohatera w naszym przypadku aktualnie jest to kwadrat
        player.setBounce(0);
        player.setCollideWorldBounds(true); // dodanie kolizji bohatera, z oknem
        this.physics.add.collider(player, platform); //fizyka kolizji z platformami ale nie działa :/
         background.setPipeline('Light2D'); // dodanie efektu światła na backgroundzie (przyciemnienie tła)

    
        
    },

    update: function()
    {
        if(cursors.left.isDown){   // sterowanie postacią dla każdego klawisza
            player.x -= playerSpeed;
        }
        if(cursors.right.isDown){
            player.x += playerSpeed;
        }
        if(cursors.up.isDown){
            player.y -= playerSpeed;
        }
        if(cursors.down.isDown){
            player.y += playerSpeed;
        }

        light.x = player.x; // ustawienie światła w pozycji bohatera
        light.y = player.y;


    }

    
})


    var config = {
        type: Phaser.AUTO, //sposób renderowania grafiki
        width: 1600, //rozdzielczość
        height: 900,
        physics: { //fizyka, to jest do zmiany i ustalenia jaka będzie odpowiednia
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false
            }
        },
        scene: [
           Preloader, MainMenu, Stage1, Intro
        ]
    };

    var game = new Phaser.Game(config); //nie dokońca wiem po co to jest, do ustalenia


</script>

</body>
</html>